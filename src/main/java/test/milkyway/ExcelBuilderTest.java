package test.milkyway;

import junit.framework.Assert;
import junit.framework.TestCase;
import milkyway.excel.ExcelBuilder;
import milkyway.excel.FormData;
import milkyway.excel.Settings;
import org.junit.Test;

public class ExcelBuilderTest extends TestCase {
    @Test
    public void testMakeExcel()throws Exception{
        String settingsJson = "{\"chocolate-control-column\":{\"weight\":\"0\",\"caption\":\"cap1\",\"key\":\"chocolate-control-column\",\"width\":\"24\"},\"numattachments\":{\"weight\":\"2\",\"caption\":\"cap2\", \"key\":\"numattachments\",\"width\":\"120\"}}";
        Settings settings = new Settings(settingsJson);
        String objectJson = "{\"17211\":{\"id\":\"17211\",\"chocolate-control-column\":\"тест1\",\"numattachments\":\"24\"},\"9870\":{\"id\":\"9870\",\"chocolate-control-column\":\"выфвыф\",\"numattachments\":\"120\"}}";
        FormData data = new FormData(objectJson);
        ExcelBuilder excelBuilder  = new ExcelBuilder();
        byte[] buffer =excelBuilder.makeExcel(data, settings);
        Assert.assertEquals(13824, buffer.length);
    }
    @Test
    public void testMakeExcelWithNullValues()throws Exception{
        String settingsJson = " {\"stateid\":{\"key\":\"stateid\",\"weight\":1,\"width\":\"150\",\"caption\":\"Статус\"},\"priorityid\":{\"key\":\"priorityid\",\"weight\":2,\"width\":\"150\",\"caption\":\"Приоритет\"},\"ownersidlist\":{\"key\":\"owners\",\"weight\":3,\"width\":\"150\",\"caption\":\"Заказчики\"},\"timeup\":{\"key\":\"timeup\",\"weight\":4,\"width\":\"150\",\"caption\":\"Срок заказчика\"},\"usersidlist\":{\"key\":\"users\",\"weight\":5,\"width\":\"150\",\"caption\":\"Исполнители\"},\"dateforexecutor\":{\"key\":\"dateforexecutor\",\"weight\":6,\"width\":\"150\",\"caption\":\"Срок исполнителя\"},\"description\":{\"key\":\"description\",\"weight\":7,\"width\":\"150\",\"caption\":\"Описание\"},\"resultdescription\":{\"key\":\"resultdescription\",\"weight\":8,\"width\":\"150\",\"caption\":\"Результат\"},\"id\":{\"key\":\"id\",\"weight\":9,\"width\":\"150\",\"caption\":\"Ключ\"},\"lastmodifier\":{\"key\":\"lastmodifier\",\"weight\":10,\"width\":\"150\",\"caption\":\"Изменил\"},\"lastmodifydate\":{\"key\":\"lastmodifydate\",\"weight\":11,\"width\":\"150\",\"caption\":\"Дата последнего изменения\"},\"numattachments\":{\"key\":\"numattachments\",\"weight\":12,\"width\":\"150\",\"caption\":\"Вложения\"}}";
        Settings settings = new Settings(settingsJson);
        String objectJson = " {\"17894\":{\"users\":\"Теляков Али Шамильевич/Целищев Семен Олегович\",\"subject\":\"\",\"parentid\":\"0\",\"lastmodifydate\":\"07.30.2014 09:06:12\",\"serviceid\":\"0\",\"id\":\"17894\",\"dateforexecutor\":null,\"username\":\"Целищев Семен Олегович\",\"description\":\"Доработки Арбуза.<br><b>ADD:</b><br>1) Координаты центра карты(широта, долгота) пример [59.94, 30.31]<br>2)Название столбца, отвечающего за широту пример: Latitude<br>3)Название столбца,  отвечающего за долготу Longitude<br><b>DEPRECATED:</b><br>   <span class=\\\"wysiwyg-color-blue\\\">ColumnProperties:</span><br>a)Tabid]<br>б) Много дублирующих контролов (Onoff == checkbox || selectitems = treedialog || text ==textdialog || valuelist ==valuelistallowner == valuelistwithoutblank). Отличаются только на некоторые атрибуты<br>    <span class=\\\"wysiwyg-color-blue\\\">AgileFilters:</span><br>a)StandartType (19 - использовался для деревьев, 20 - до сих пор используется для чекбоксов(удалить)) <br>б)DialogType - свойство которое отображается только дерево( значение tdialog и tree) - переделать в FilterType)<br>в) ReadProcForIdList - можно удалять<br><br> Целищев Семён Олегович 04.04.2014 11:58\",\"statedescription\":\"Поручение создано, но никакие работы ещё не проводятся\",\"changedstatedescription\":\"В Работе->Новое, Целищев 30.07.2014 09:06 Прошло дней:176\",\"numattachments\":null,\"priorityname\":\"Средний\",\"alternatecolor\":\"16777215\",\"stateid\":\"2\",\"files\":\"\",\"temporarylockobservers\":null,\"taskstypesid\":\"0\",\"usersidlist\":\"169|1180|\",\"childtaskscount\":null,\"deleteduser\":null,\"color\":\"12880127\",\"resultdescription\":\"1111\",\"taskstatus\":\"Новое\",\"priorityid\":\"5\",\"usersviews\":\"Теляков Али Шамильевич 31.03.2014 08:01/Целищев Семен Олегович 04.06.2014 16:55\",\"lastmodifier\":\"Целищев Семен Олегович\",\"insdate\":\"03.27.2014 09:20:01\",\"ownersidlist\":\"1180|321|\",\"owners\":\"Целищев Семен Олегович/Мелков Денис Александрович\",\"timeup\":\"04.01.2014 13:00:00\"},\"19062\":{\"users\":\"Теляков Али Шамильевич\",\"subject\":\"\",\"parentid\":\"0\",\"lastmodifydate\":\"01.20.2015 09:04:40\",\"serviceid\":\"0\",\"id\":\"19062\",\"dateforexecutor\":null,\"username\":\"Целищев Семен Олегович\",\"description\":\"В согласованиях ломается нумерация этапов(пример договор 12009) Скорее всего дело в скрипте script run workflow.WorkflowStepsRenumerateLast [ParentID];dataform.refreshdata\",\"statedescription\":\"Исполнитель начал работу\",\"changedstatedescription\":\"Новое->В Работе, Теляков 20.01.2015 09:04 Прошло дней:2\",\"numattachments\":null,\"priorityname\":\"Средний\",\"alternatecolor\":\"13893372\",\"stateid\":\"3\",\"files\":\"\",\"temporarylockobservers\":null,\"taskstypesid\":\"0\",\"usersidlist\":\"169|\",\"childtaskscount\":null,\"deleteduser\":null,\"color\":\"12880127\",\"resultdescription\":\"Как продвигается поручение? почему не выставлены сроки по поручению, согласно регламенту о поручениях в IT отделе<b><span class=\\\"wysiwyg-color-maroon\\\"><span class=\\\"wysiwyg-color-silver\\\">?</span></span></b><span class=\\\"wysiwyg-color-maroon\\\"><span class=\\\"wysiwyg-color-silver\\\"> </span></span>\",\"taskstatus\":\"В Работе\",\"priorityid\":\"5\",\"usersviews\":\"Теляков Али Шамильевич 22.07.2014 11:00\",\"lastmodifier\":\"Теляков Али Шамильевич\",\"insdate\":\"07.07.2014 11:48:21\",\"ownersidlist\":\"1180|\",\"owners\":\"Целищев Семен Олегович\",\"timeup\":\"11.13.2014 18:00:00\"},\"20782\":{\"users\":\"Титов Дмитрий Викторович\",\"subject\":\"\",\"parentid\":\"0\",\"lastmodifydate\":\"11.18.2014 11:10:03\",\"serviceid\":\"0\",\"id\":\"20782\",\"dateforexecutor\":null,\"username\":\"Целищев Семен Олегович\",\"description\":\"Не работает поиск в Web интерфейсе к почте\",\"statedescription\":\"Поручение создано, но никакие работы ещё не проводятся\",\"changedstatedescription\":\"\",\"numattachments\":null,\"priorityname\":\"Средний\",\"alternatecolor\":\"16777215\",\"stateid\":\"2\",\"files\":\"\",\"temporarylockobservers\":null,\"taskstypesid\":\"0\",\"usersidlist\":\"253|\",\"childtaskscount\":null,\"deleteduser\":null,\"color\":null,\"resultdescription\":null,\"taskstatus\":\"Новое\",\"priorityid\":\"5\",\"usersviews\":\"\",\"lastmodifier\":\"Целищев Семен Олегович\",\"insdate\":\"11.18.2014 11:10:03\",\"ownersidlist\":\"1|1180|\",\"owners\":\"Иваницкий Константин Владимирович/Целищев Семен Олегович\",\"timeup\":null},\"21070\":{\"users\":\"Теляков Али Шамильевич/Мелков Денис Александрович/Целищев Семен Олегович\",\"subject\":\"\",\"parentid\":\"0\",\"lastmodifydate\":\"12.26.2014 09:57:12\",\"serviceid\":\"0\",\"id\":\"21070\",\"dateforexecutor\":\"01.31.2015 17:00:00\",\"username\":\"Габриелян Анна Владимировна\",\"description\":\"База \\\"Подписи в ДДУ\\\". В данной базе содержаться сведения по юридическим лицам. Проставляя галочку, автоматически используется информация для внесения в оформляемые документы.<br>Информация для подстановки в преамбулы документов. Т.к. по юридическим лицам строительство производится в несколько очередей, то и информация для подстановки в преамбулу документа соответственно разная.<br>Прошу продумать и сделать разбивку юридич.лиц. по объектам и очередям. Таким образом мы сможем вносить информацию для подстановки в договор по каждой очереди отдельно. Габриелян А.В. 15.12.14<br>\",\"statedescription\":\"Поручение создано, но никакие работы ещё не проводятся\",\"changedstatedescription\":\"\",\"numattachments\":null,\"priorityname\":\"Высокий\",\"alternatecolor\":\"16777215\",\"stateid\":\"2\",\"files\":\"\",\"temporarylockobservers\":null,\"taskstypesid\":\"0\",\"usersidlist\":\"169|321|1180|\",\"childtaskscount\":null,\"deleteduser\":null,\"color\":null,\"resultdescription\":null,\"taskstatus\":\"Новое\",\"priorityid\":\"1\",\"usersviews\":\"\",\"lastmodifier\":\"Теляков Али Шамильевич\",\"insdate\":\"12.15.2014 12:32:12\",\"ownersidlist\":\"1173|204|468|1183|372|1152|\",\"owners\":\"Аверченкова Елена Валерьевна/Габриелян Анна Владимировна/Потепкина Марина Владимировна/Романовская Виктория Павловна/Трусов Владимир Михайлович/Тюрина Любовь Сергеевна\",\"timeup\":\"12.31.2014 18:00:00\"}}";
        FormData data = new FormData(objectJson);
        ExcelBuilder excelBuilder  = new ExcelBuilder();
        byte[] buffer =excelBuilder.makeExcel(data, settings);
        Assert.assertEquals(17920, buffer.length);
    }
}
